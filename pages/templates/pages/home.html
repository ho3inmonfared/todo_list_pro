{% extends '_base.html' %}
{% block content %}
  <div class="main-content w-full min-h-full px-4 py-8 md:py-12">
    <div class="max-w-lg mx-auto w-full">
      <!-- Header -->
      <div class="header-section text-center mb-8">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</h1>
        <p class="text-gray-500 text-sm">{{ completed_tasks }} Ø§Ø² {{ total_tasks }} Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</p>
        <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden max-w-full">
          {% if total_tasks > 0 %}
            <div class="progress-bar h-full rounded-full" style="width: {{ completed_tasks|floatformat:0|divisibleby:total_tasks|floatformat:0 }}%;"></div>
          {% else %}
            <div class="progress-bar h-full rounded-full" style="width: 0%;"></div>
          {% endif %}
        </div>
      </div>

      <!-- Add Task Form -->
      <form method="POST">
        {% csrf_token %}
        <div class="input-section glass-card rounded-2xl p-4 mb-6 shadow-xl shadow-purple-500/10">
          <div class="flex gap-3 w-full">
            <input type="text" name="text" placeholder="Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯..." class="input-field flex-1 px-4 py-3 rounded-xl bg-white/50 border border-gray-200 focus:outline-none focus:border-indigo-400 text-gray-700 placeholder-gray-400" required />
            <button name="add_task" class="add-btn w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
            </button>
          </div>

          <!-- Categories -->
          <div class="flex gap-2 mt-4 flex-wrap">
            {% for category in categories %}
              <label class="category-badge px-3 py-1 rounded-full text-xs font-medium cursor-pointer
              bg-{{ category.color }}-100 text-{{ category.color }}-600 hover:bg-{{ category.color }}-200">
                <input type="radio" name="category" value="{{ category.id }}" class="hidden" required />
                {{ category.title }}
              </label>
            {% endfor %}
          </div>
        </div>
      </form>

      <!-- Task List -->
      <div class="space-y-3">
        {% for task in tasks %}
          <form method="POST" class="todo-item glass-card rounded-2xl p-4 shadow-lg shadow-purple-500/5">
            {% csrf_token %}
            <input type="hidden" name="task_id" value="{{ task.id }}" />
            <div class="flex items-center gap-3 w-full">
              <!-- Checkbox -->
              <button type="submit" name="toggle_task" class="checkbox-custom w-6 h-6 rounded-lg flex items-center justify-center cursor-pointer
              {% if task.is_complete %} checked {% endif %}">
                {% if task.is_complete %}
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                  </svg>
                {% endif %}
              </button>

              <!-- Task Text -->
              <div class="flex-1 min-w-0">
                <p class="todo-text {% if task.is_complete %}completed{% endif %} text-sm md:text-base">{{ task.text }}</p>
                <div class="flex items-center gap-2 mt-1 flex-wrap">
                  <span class="text-xs text-gray-500">{{ task.category.title }}</span>
                </div>
              </div>

              <!-- Delete Button -->
              <button type="submit" name="delete_task" class="delete-btn w-8 h-8 rounded-lg bg-red-50 text-red-400 flex items-center justify-center hover:bg-red-100 transition-colors">ğŸ—‘</button>
            </div>
          </form>
        {% empty %}
          <p class="text-gray-400 text-center mt-4">Ù‡ÛŒÚ† Ú©Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ ÛŒÚ© ØªØ³Ú© Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯!</p>
        {% endfor %}
      </div>

      <!-- Stats Section -->
      <div class="mt-8 grid grid-cols-3 gap-3">
        <div class="glass-card rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-indigo-600">{{ total_tasks }}</div>
          <div class="text-xs text-gray-500 mt-1">Ú©Ù„ Ú©Ø§Ø±Ù‡Ø§</div>
        </div>
        <div class="glass-card rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-emerald-600">{{ completed_tasks }}</div>
          <div class="text-xs text-gray-500 mt-1">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</div>
        </div>
        <div class="glass-card rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-amber-600">{{ pending_tasks }}</div>
          <div class="text-xs text-gray-500 mt-1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
